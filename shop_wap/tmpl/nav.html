
<header class="header orflow fixed">
    <div class="header-10rem">
        <div class="icon-wrap lf">
            <a href="javascript:history.go(-1)"> <i class="icon middle"></i> </a>
        </div>
        <div class="search lf">
            <input type="text" placeholder=""/>
        </div>
    </div>
</header>

<!--小导航    start-->
<div class="nav orflow fixed">
    <div class="nav-wrap">
        <div class="nav-bar lf">
            <div class="nav-scroll-wrap">
                <ul id="nav" class="lf">

                </ul>
                <span class="sideline"></span>
            </div>
        </div>
        <div class="nav-right-icon rt">
            <span class="icon pop-up-icon"></span>
        </div>
    </div>
</div>
<!--小导航    end-->
<!--右侧 的弹出框   start-->
<div class="pop-up">
    <div class="hot-search orflow">
        热门搜索：
        <div class="search">
            <div class="keyW">
                <span>服饰内衣</span>
                <span>电子数码</span>
                <span>生鲜水果</span>
            </div>
            <input type="text" />
        </div>
    </div>
    <div class="pop-up-content">
        <ul class="search-results-list">
        </ul>
    </div>
</div>
<!--右侧 的弹出框   end-->

<style>
    /*  header  start*/
    .header-wrap{position: fixed;top:0;left:0;z-index: 400;height:2.359375rem;width:100%;}
    .header.fixed{height:1.109375rem;position:fixed;top:0;left:0;z-index: 400; -webkit-transform: translateZ(0);}
    .header-10rem{width:10rem;}
    .header{width:100%;padding:0.15625rem 0.46875rem;}
    .header .icon-wrap{position:relative;height:0.796875rem;width:0.796875rem;line-height:0.796875rem;}
    .header .icon{background:url(../images/back@3x.png) no-repeat;width:0.625rem;height:0.625rem;background-size: cover;}
    .header .search{width:8.28125rem;text-align: center;}  /*6.796875*/
    .header .search input{height:0.796875rem;width:8.28125rem;font-size:0.375rem;text-align: center;}   /*width:6.015625rem;*/
    .header .search input::-webkit-input-placeholder{color:#fff;}
    .header .search input[placeholder]{color:#fff;}
    /*  header  end*/

    /*小导航   start*/
    /*.nav-wrap{width:100%;height:1.25rem;position:relative;}*/
    .nav{width:100%;height:1.25rem;background-color:#fff;border-bottom:1px solid #f5f5f5;}   /*position:absolute;top:0;left:0;z-index:400;*/
    .nav.fixed{position:fixed;top:1.109375rem;left:0;z-index: 400; -webkit-transform: translateZ(0);}
    .nav .nav-wrap{width:10rem;margin: 0 auto;}
    .nav .nav-bar{position:relative;width:8.90625rem;height:1.25rem;overflow: scroll;-webkit-overflow-scrolling: touch;}  /*width:10rem;margin:0 auto;*/
    .nav .nav-scroll-wrap{position:absolute;left:0;height:1.25rem;}  /*460px  width:8.90625rem;*/
    .nav .nav-scroll-wrap ul{height:1.25rem;white-space: nowrap;}  /*width:8.90625rem;*/
    .nav .nav-scroll-wrap ul li{display:inline-block;}
    .nav .nav-scroll-wrap .sideline{position:absolute;border:none;height:0.03125rem;background-color:#E45050;top:1.171875rem;}
    .nav a{display:inline-block;margin:0 0.2rem;padding:0 0.1125rem;color:#333;font-size:0.4375rem;}
    .nav a{height:1.25rem;line-height: 1.25rem;}
    .nav .nav-right-icon{width:1.09375rem;height:1.25rem;text-align: center;border-left:1px solid #eee;}
    .nav .nav-right-icon .icon{background:url(../images/all-icon@3x.png) no-repeat;background-size:cover;width:0.625rem;height:0.625rem;margin-top:0.3125rem;}
    /*小导航   end*/

    /*右侧 弹出框   start*/
    /*.tap-cover{position:fixed;width:10rem;height:100%;top:0;left:0;z-index:800;}*/
    .pop-up{display:none;position:fixed;-webkit-transform: translateZ(0);z-index:998;top:2.35rem;bottom:0;left:50%;margin-left:5rem;background-color:#f2f2f2;width:10rem;height:100%;overflow:hidden;-webkit-overflow-scrolling: touch;font-size:0.40625rem;padding:0.46875rem;}  /*  */
    .pop-up .hot-search{color:#555;height:1.96875rem;}
    .pop-up .pop-up-content{position:absolute;top:2.4375rem;bottom:0;width:10rem;-webkit-overflow-scrolling: touch;}  /*overflow:auto;*/
    .pop-up .search{position: relative;height:0.859375rem;width:100%;}
    .pop-up input{position:absolute;width:100%;height:0.859375rem;top: -0.3125rem;left: 0;z-index:5;background:transparent;font-size:0.40625rem;color:#555;}
    .pop-up .search,.pop-up input{margin:0.3125rem 0 0.25rem;}
    .pop-up .search .keyW span{display:inline-block;background-color:#e6e6e6;padding:0.15625rem 0.234375rem;margin-right:0.46875rem;border-radius:0.59375rem;-webkit-border-radius:0.59375rem;-o-border-radius:0.59375rem;-moz-border-radius:0.59375rem;-ms-border-radius:0.59375rem;}
    .pop-up .search-results-list{overflow:auto;-webkit-overflow-scrolling: touch;height:100%;border-top:1px solid #E6E6E6;}
    .pop-up .search-results-list .result-item a{display:inline-block;height:1.25rem;line-height:1.25rem;padding-left:0.234375rem;width:100%;color:#333;font-size:0.40625rem;}
    .pop-up .search-results-list .result-item{border-bottom:1px solid #e6e6e6;}
    /*右侧 弹出框   end*/
</style>

<script>

var hasmore = true;
var pagesize = 24;
var curpage = 0;
var firstRow = 0;

$(function () {
    $('.header .search input[type="text"]').attr('placeholder',title);
    $('.header').css('background-color',bg);
    $('.header .search input').css('background-color',bg);

    //初始化   获取 各个数值   start
    var windowH = $(window).height();
    var headerH = $(".header-wrap").outerHeight(true);
    var footerH = $(".nav-fixed").outerHeight(true);
    //初始化   获取 各个数值   end

    //  右侧 弹框       start
    //动态获取  右侧  弹出框的高度     start
    var  H = windowH - headerH  -footerH;
    $(".pop-up").css({'height':H +"px"});
    //动态获取  右侧  弹出框的高度     end
    $(".nav-right-icon").click(function(){
        if(!($(".pop-up").hasClass("ed"))){
            $(".pop-up").addClass("ed");
            if(!($(".pop-up").hasClass("animated"))){
                $(".pop-up").addClass("block");
                $(".pop-up").addClass("block");
                $(".pop-up").addClass("animated");

                $(".pop-up").animate({"marginLeft":"-5rem"},500,function(){
                    $(".pop-up").removeClass("ed");
                });
            }else{
                popUpStop();
            }
        }else{
            return false;
        }
    });

    $(".pop-up .search input").click(function(){
        $(".search .keyW span").remove();
    });
    //  右侧 弹框       end

    //  收起 右侧弹窗  function  start
    function popUpStop(){
        $(".pop-up").removeClass("animated");
        $(".pop-up").animate({"marginLeft":"5rem"},500,function(){
            $(".pop-up").removeClass("block");
            $(".pop-up").removeClass("ed");
        });
    }
    //  收起 右侧弹窗  function end

    $.getJSON(ApiUrl + "/index.php?ctl=Goods_Cat&met=getOneCat&typ=json", function (data) {
        if(data.status == 200){
            $('#nav').empty();
            var html = '<li data-id="0"><a href="javascript:;">全部</a></li>';
            var page_html = '<div class="swiper-slide"><div class="main"></div></div>';
            $.each(data.data,function (k,v) {
                html += '<li data-id="'+v['cat_id']+'"><a  href="javascript:;">'+v['nav_name']+'</a></li>';
                page_html += '<div class="swiper-slide"><div class="main"></div></div>';
            });

            $('#nav').html(html);
            $('.page .swiper-wrapper').append(page_html);
            $(".main").css({"height":windowH-footerH -headerH+"px"});

            //导航处   start
            var sidelineLeftSpread = 300;
            var navScrollWrapLeftSpread = 300;
            var navli_w=$(".nav-scroll-wrap li").first().children("a").innerWidth();
            $(".sideline").width(navli_w);
            var marginStr = $(".nav-scroll-wrap a").css("margin");
            var marginL = parseFloat(marginStr.split(" ")[1]);
            $(".sideline").css({"left":marginL + "px"});
            $(".nav-scroll-wrap li").on('click', function(){
                if($(".more-activties-wrap").hasClass("animated") || $(".pop-up").hasClass("animated")){
                    popUpStop();
                    return false
                }else{
                    navli_w=$(this).children("a").outerWidth();
                    $(".sideline").stop(true);
                    $(".sideline").animate({left:$(this).position().left + marginL },sidelineLeftSpread);
                    $(".sideline").animate({width:navli_w});
                    $(this).addClass("curr").siblings().removeClass("curr");
                    var nav_w = ($(".nav").width() - navli_w) / 2;
                    var fnl_l;
                    var fnl_x = parseInt($(this).position().left);
                    if (fnl_x <= nav_w) {
                        fnl_l = 0;
                    } else if (nav_w - fnl_x <= nb_w - nsw_w) {
                        fnl_l = nb_w - nsw_w;
                    } else {
                        fnl_l = nav_w - fnl_x;
                    }
                    $(".nav-bar").animate({ "scrollLeft" : -fnl_l}, navScrollWrapLeftSpread);
                    mySwiper_page.slideTo($(this).index(), 1000);
                }
            });

            var nsw_w=$(".nav-scroll-wrap").width();
            var nb_w=$(".nav-bar").width();
            //导航处   end

            /*初始化  swiper*/
            var mySwiper_page = new Swiper ('.page.swiper-container', {
                direction: 'horizontal',
                loop: false,
                onTransitionStart:function(swiper){
                    var nav_w = ($(".nav").width() - navli_w) / 2;
                    var fnl_l;
                    var fnl_x = parseInt($('.nav .nav-scroll-wrap li').eq(mySwiper_page.activeIndex).position().left);
                    if (fnl_x <= nav_w) {
                        fnl_l = 0;
                    } else if (nav_w - fnl_x <= nb_w - nsw_w) {
                        fnl_l = nb_w - nsw_w;
                    } else {
                        fnl_l = nav_w - fnl_x;
                    }
                    $(".main-wrap").scrollTop(0);
                    $(".nav-bar").animate({
                        "scrollLeft" : -fnl_l
                    }, navScrollWrapLeftSpread);
                    $(".sideline").stop(true);
                    $(".sideline").animate({left:$('.nav .nav-scroll-wrap li').eq(mySwiper_page.activeIndex).position().left + marginL },sidelineLeftSpread);
                    $(".sideline").animate({width:$('.nav .nav-scroll-wrap li').eq(mySwiper_page.activeIndex).children("a").outerWidth()});
                    $('.nav .nav-scroll-wrap li').eq(mySwiper_page.activeIndex).addClass('curr').siblings("li").removeClass('curr');

                    //console.log(mySwiper_page.activeIndex);
                    if(mySwiper_page.activeIndex > 0){
                        var cat_id = $('.nav .nav-scroll-wrap li').eq(mySwiper_page.activeIndex).data('id');
                        callback(cat_id);

                        $.getJSON(ApiUrl + "/index.php?ctl=Goods_Cat&met=getSubCat&typ=json",{id:cat_id}, function (e) {
                            if (e.status == 200) {
                                $('.pop-up-content .search-results-list').empty();
                                var sub_ht = '';
                                $.each(e.data,function (k,v) {
                                    sub_ht += '<li  class="result-item" data-id="'+v['cat_id']+'"><a  href="javascript:;">'+v['cat_name']+'</a></li>';
                                });
                                $('.pop-up-content .search-results-list').html(sub_ht);
                            }
                        });
                    }else{
                        $('.pop-up-content .search-results-list').empty();
                    }


                },
            });
            /*初始化  swiper end*/

            //加载首页
            callback(0);

            //滚动到底部 加载更多
            $(".main").scroll(function(){
                if(hasmore){
                    if($(this)[0].scrollTop + H >= $(this)[0].scrollHeight - 1){
                        console.log(111111111111);

                    if($(this)[0].scrollTop + H >= $(this)[0].scrollHeight - 10){

                        callback(0,true);
                    }
                }
        }
    })

</script>